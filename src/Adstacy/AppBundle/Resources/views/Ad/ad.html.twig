<div class="ad masonry-item">
  <div class="ad-image">
    <a href="{{ path('adstacy_app_ad_show', {id: ad.id}) }}">
      <img class="lazy" src="{{ asset('bundles/adstacyapp/img/transparent.gif') }}"
        data-original="{{ vich_uploader_asset(ad, 'image')|imagine_filter('thumbnail') }}"
        width="{{ thumb_width }}px" height="{{ ad.imageHeight(thumb_width) }}px"
        alt="{{ ad.description }}">
    </a>
  </div>

  {# weird bugs. cannot use ad-section class name #}
  <div class="ad-sect break-word">
    <p>{{ parse_url(parse_hashtag(ad.description)) }}</p>
  </div>

  <div class="ad-sect ad-counter text-overflow">
    <a href="{{ path('adstacy_app_ad_promotes', {id: ad.id}) }}"><span class="promotes-count">{{ ad.promoteesCount }}</span> Promotes</a>
    <a href="{{ path('adstacy_app_ad_show', {id: ad.id}) }}#comments"><span class="comments-count">{{ ad.commentsCount }}</span> Comments</a>
  </div>

  <div class="ad-sect ad-user clearfix">
    {% include 'AdstacyAppBundle:User:user_mini.html.twig' with {user: ad.user, text: ago(ad.created), as_link: true} %}
    <div class="ad-user-action btn-group">
      {% if app.user %}
        {% set promoted = app.user.hasPromote(ad) %}
        <a href="{{ path('adstacy_app_ad_promote', {id: ad.id}) }}" class="btn btn-primary btn-promote promote {% if promoted %}hide{% endif %}" title="promote">
          <i class="icon-bullhorn"></i>
        </a>
        <a href="{{ path('adstacy_app_ad_unpromote', {id: ad.id}) }}" class="btn btn-success btn-promote unpromote {% if not promoted %}hide{% endif %}" title="unpromote">
          <i class="icon-bullhorn"></i>
        </a>
      {% else %}
        <a href="{{ path('adstacy_app_ad_promote', {id: ad.id}) }}" class="btn btn-primary btn-promote" title="promote">
          <i class="icon-bullhorn"></i>
        </a>
      {% endif %}

      <div class="btn-group">
        <a class="btn btn-default dropdown-toggle" data-toggle="dropdown">
          <i class="icon-share"></i>
        </a>
        <ul class="ad-social-list dropdown-menu pull-right">
          <li>
            {% set adUrl = url('adstacy_app_ad_show', {id: ad.id}) %}
            {% set tags = ad.tags|join(',') %}
            {% set desc = remove_hashtag(ad.description) %} {# remove hashtags because # character is fragment in url #}
            {% set twitterUrl = "https://twitter.com/share?url=#{adUrl}&text=#{desc}&hashtags=#{tags}" %}
            {% set facebookUrl = "https://www.facebook.com/sharer/sharer.php?u=#{adUrl}" %}
            <a href="{{ facebookUrl }}" class="facebook-share">
              <i class="icon-facebook"></i> Share
            </a>
          </li>
          <li>
            <a href="{{ twitterUrl }}" class="tweet">
              <i class="icon-twitter twitter-share"></i> Tweet
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  {% if promotedBy is defined and promotedBy == true %}
    {% if app.user %}
      {% set followingsWhoPromoted = app.user.getFollowingsPromoted(ad) %}
      {% if followingsWhoPromoted|length > 0 %}
        <div class="ad-sect">
          <p class="text-muted">{{"promoted_by"|trans}}
            <a class="link-muted" href="#">
              <b>{{ followingsWhoPromoted|join(',') }}</b>
            </a>
          </p>
        </div>
      {% endif %}
    {% endif %}
  {% endif %}
  <div class="ad-comment">
    <form action="{{ path('adstacy_app_ad_comment', {id: ad.id}) }}" method="post">
      <textarea name="comment[content]" required="required" class="comment-box" placeholder="Write a comment..."></textarea>
      <input type="submit" value="{{"comment"|trans}}" class="hide">
    </form>
  </div>
</div>
