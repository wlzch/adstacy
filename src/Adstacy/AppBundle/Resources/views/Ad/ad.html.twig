<div class="ad">
  <div class="pic">
    <a href="{{ path('adstacy_app_ad_show', {id: ad.id}) }}">
      <img class="lazy" src="{{ asset('bundles/adstacyapp/img/transparent.gif') }}"
        data-original="{{ vich_uploader_asset(ad, 'image')|imagine_filter('thumbnail') }}"
        width="{{ thumb_width }}px" height="{{ ad.thumbHeight }}px" alt="{{ ad.description }}">
    </a>
    {#
      There are 3 situations where promoted sign will appear:
      1. If user variables is passed, then that user will be checked wheter he has promote the ad
      2. If logged in user has promote the ad
      3. If logged in user's followers has promote the ad
      Promoted sign will only appear if the calling template pass a user variable to check for promoted or if the calling template doesnot pass user, it is assumed that the user passed is the current logged in user

      NOTE: Option 3 will be temporarily disabled for performance reason
    #}
    {% if user is defined and user and user.hasPromote(ad) %}
      <div class="promoted-container"></div>
      <span class="promoted"><span aria-hidden="true" data-icon="&#xe008;"></span></span>
    {% elseif app.user and app.user.hasPromote(ad) %}
      <div class="promoted-container"></div>
      <span class="promoted"><span aria-hidden="true" data-icon="&#xe008;"></span></span>
    {% elseif app.user and user_followings_has_promote(app.user, ad) %}
      <div class="promoted-container"></div>
      <span class="promoted"><span aria-hidden="true" data-icon="&#xe008;"></span></span>
    {% endif %}
  </div>

  <div class="ad-section ad-description">
    <p>{{ parse_url(parse_hashtag(ad.description)) }}</p>
  </div>

  <div class="ad-section ad-counter">
    <a href="#"><span class="promotes-count">{{ ad.promoteesCount }}</span> Promotes</a>
  </div>

  <div class="ad-section ad-user clearfix">
    {% include 'AdstacyAppBundle:User:user_mini.html.twig' with {user: ad.user, text: ago(ad.created), as_link: true} %}
    <div class="ad-user-action btn-group">
      {% if app.user %}
        {% set promoted = app.user.hasPromote(ad) %}
        <a href="{{ path('adstacy_app_ad_unpromote', {id: ad.id}) }}" class="btn btn-primary btn-promote unpromote {% if not promoted %}hide{% endif %}"><span aria-hidden="true" data-icon="&#xe007;"></span></a>
        <a href="{{ path('adstacy_app_ad_promote', {id: ad.id}) }}" class="btn btn-default btn-promote promote {% if promoted %}hide{% endif %}"><span aria-hidden="true" data-icon="&#xe007;"></span></a>
      {% endif %}
      <div class="btn-group">
        <a class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span aria-hidden="true" class="icon-share"></span></a>
        <ul class="ad-social-list dropdown-menu" role="menu">
          <li>
            {% set adUrl = url('adstacy_app_ad_show', {id: ad.id}) %}
            {% set tags = ad.tags|join(',') %}
            {% set desc = remove_hashtag(ad.description) %} {# remove hashtags because # character is fragment in url #}
            {% set twitterUrl = "https://twitter.com/share?url=#{adUrl}&text=#{desc}&hashtags=#{tags}" %}
            {% set facebookUrl = "https://www.facebook.com/sharer/sharer.php?u=#{adUrl}" %}
            <a href="{{ facebookUrl }}" class="facebook-share">
              <span aria-hidden="true" data-icon="&#xe003;"></span> Facebook
            </a>
          </li>
          <li>
            <a href="{{ twitterUrl }}" class="tweet">
              <span aria-hidden="true" data-icon="&#xe002;" class="twitter-share"></span> Twitter
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
