<div class="advert item">
  {% if ad.type == 'image' %}
    <div class="advert-img">
      <a href="{{ path('adstacy_app_ad_show', {id: ad.id}) }}">
        <img class="lazy" src="{{ asset('bundles/adstacyapp/img/transparent.gif') }}"
          data-original="{{ vich_uploader_asset(ad, 'image')|imagine_filter('thumbnail') }}"
          width="450" height="450"
          alt="{{ ad.description }}">
      </a>
    </div>
  {% elseif ad.type == 'text' %}
    <div class="advert-text">
      <h3>{{ ad.title }}</h3>
      <p>{{ ad.description|raw }}</p>
    </div>
  {% elseif ad.type == 'youtube' %}
    <div class="advert-video" data-youtube-id="{{ ad.youtubeId }}">
      <a href="#">
        <img class="lazy" src="{{ asset('bundles/adstacyapp/img/transparent.gif') }}"
          data-original="http://img.youtube.com/vi/{{ ad.youtubeId }}/0.jpg"
          width="{{ thumb_width }}" height="{{ thumb_width * (9/16) }}"
        >
      </a>
      <div class="yt-player"></div>
    </div>
  {% endif %}

  <div class="advert-action clearfix">
    <div class="btn-group pull-left">
      {# <a href="{{ path('adstacy_app_ad_promotes', {id: ad.id}) }}" class="btn btn-default"><span class="promotes-count">{{ ad.promoteesCount }}</span></a> #}
      {% if app.user %}
        {% set promoted = app.user.hasPromote(ad) %}
        <a href="{{ path('adstacy_app_ad_promote', {id: ad.id}) }}" class="btn btn-default btn-promote promote {% if promoted %}hide{% endif %}" title="Broadcast">
          <i class="icon icon-bullhorn"></i><span>broadcast</span>
        </a>
        <a href="{{ path('adstacy_app_ad_unpromote', {id: ad.id}) }}" class="btn btn-primary btn-promote unpromote {% if not promoted %}hide{% endif %}" title="Unbroadcast">
          <i class="icon icon-bullhorn"></i><span>unbroadcast</span>
        </a>
      {% else %}
        <a href="{{ path('adstacy_app_ad_promote', {id: ad.id}) }}" class="btn btn-default btn-promote" title="Broadcast">
          <i class="icon icon-bullhorn"></i><span>broadcast</span>
        </a>
      {% endif %}
    </div>
    <div class="btn-group pull-right">
      <a class="btn btn-default btn-share">
        <i class="icon icon-share"></i>
        <span>share</span>
      </a>
      <div class="btn-group">
        <a class="btn btn-default btn-option" data-toggle="dropdown">
          <i class="icon icon-ads"></i>
          <span>more</span>
        </a>
        <ul class="dropdown-menu pull-right">
          <li><a href="{{ path('adstacy_app_ad_report', {id: ad.id}) }}" class="report"><i class="icon icon-flag"></i><span>report</span></a></li>
          {% if app.user == ad.user %}
            <li><a href="{{ path('adstacy_app_ad_edit', {id: ad.id}) }}"><i class="icon icon-edit"></i><span class="owner-action-label">{{ "edit"|trans }}</span></a></li>
            <li><a data-toggle="modal" data-target="#confirm-modal"><i class="icon icon-delete"></i><span class="owner-action-label">{{ "delete"|trans }}</span></a></li>
          {% endif %}
        </ul>
      </div>

    </div>
  </div>

  <div class="advert-action-content">
    {% set adUrl = url('adstacy_app_ad_show', {id: ad.id}) %}
    {% set tags = ad.tags|join(',') %}
    {% set desc = remove_hashtag(ad.description) %} {# remove hashtags because # character is fragment in url #}
    {% set twitterUrl = "https://twitter.com/share?url=#{adUrl}&text=#{desc}&hashtags=#{tags}" %}
    {% set facebookUrl = "https://www.facebook.com/sharer/sharer.php?u=#{adUrl}" %}
    <div class="advert-share btn-group btn-group-justified">
      <a href="{{ facebookUrl }}" class="btn btn-facebook facebook-share"><i class="icon icon-facebook"></i>Share</a>
      <a href="{{ twitterUrl }}" class="btn btn-twitter tweet"><i class="icon icon-twitter twitter-share"></i>Tweet</a>
    </div>
  </div>

  <div class="advert-detail">
    <div class="advert-user clearfix">
      {% set user = ad.user %}
      <div class="profile-picture">
        <img class="profile-picture-img" src="{{ profile_pic(user) }}" alt="{{ user.username }}" width="48" height="48">
      </div>
      <div class="user-desc">
        <a class="user-realname" href="{{ path('adstacy_app_user_profile', {username: user.username}) }}">{{ user.realName }} <span class="username">@{{ user.username }}</span></a>
      </div>
      <div class="advert-date">
        <span class="date">&middot; {{ ago(ad.created) }}</span>
      </div>
    </div>
    <p class="advert-desc">{{ parse_url(ad.description) }}</p>
    <div class="advert-tags">
      {% for tag in ad.tags %}
        <a href="{{ path('adstacy_app_search', {q: tag}) }}">#{{tag}}</a>
      {% endfor %}
    </div>
  </div>

  {% if ad.commentsCount > ad.comments|length %}
    <a href="{{ path('adstacy_app_ad_show', {id: ad.id}) }}#comments" class="btn-comments-count btn btn-default btn-block">
      <span class="comments-count">{{ ad.commentsCount }}</span> Comments &middot; {{"comment.load_more"|trans}}
    </a>
  {% endif %}

  {% if app.user %}
    <div class="advert-comment">
      {% for comment in ad.comments %}
        <div class="media">
          <div class="pull-left">
            <img src="" alt="" width="32" height="32" class="media-object">
          </div>
          <div class="media-body">
            {# <p class="media-heading">
              <a href="{{ path('adstacy_app_user_profile', {username: comment.user.username}) }}">{{ comment.user.realName }}</a>
              <small>@{{ comment.user.userName }}</small>
              <time>~ {{ ago(comment.created) }}</time>
            </p> #}
            <p class="media-heading">
              <a><strong>Erwin Zhang</strong></a>
              <span class="text-muted">
                @<span>rwinz</span>
                <time>~ 2 weeks ago</time>
              </span>
            </p>
            <p>{{ comment.content }}</p>
          </div>
        </div>
      {% endfor %}

      <div class="media">
        <div class="pull-left">
          <img src="" alt="" width="32" height="32" class="media-object">
        </div>
        <div class="media-body">
          <form action="{{ path('adstacy_app_ad_comment', {id: ad.id}) }}" method="post">
            <textarea name="comment[content]" required="required" class="comment-box" placeholder="{{"form_comment.placeholders.content"|trans}}"></textarea>
            <input type="submit" value="{{"comment"|trans}}" class="hide">
          </form>
        </div>
      </div>
    </div>
  {% endif %}
</div>

