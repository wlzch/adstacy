{% extends 'AdstacyAppBundle::layout.html.twig' %}

{% block stylesheets %}
  {{ parent() }}
  {% stylesheets filter='cssrewrite, uglifycss'
    'bundles/adstacyapp/less/layout/create_ad.less'
  %}
    <link href="{{ asset_url }}" type="text/css" rel="stylesheet">
  {% endstylesheets %}
{% endblock %}

{% block head_scripts %}
  {{ parent() }}
  {% javascripts filter='uglifyjs2'
    '@AdstacyAppBundle/Resources/public/js/FileAPI.min.js'
  %}
    <script src="{{ asset_url }}" type="text/javascript"></script>
  {% endjavascripts %}
{% endblock %}

{% block content %}
  {% set data = form.vars.data %}
  <div class="panel panel-default" id="create-ad-container">
    <div class="panel-body clearfix">
      {{ form_start(form, {attr: {class: 'submit-disable'}}) }}
        {{ form_errors(form) }}
        {{ form_label(form.image) }}
        <div class="image-area">
          {{ form_widget(form.image) }}
        </div>

        <div class="meta-area">
          <div id="create-ad-desc">
            <div class="clearfix">
              {{ form_label(form.description) }}
              <div class="pull-right">
                <a id="desc-examples" href="#" data-toggle="modal" data-target="#examples-modal">{{ "form_ad.example"|trans }}</a>
            </div>
            {{ form_widget(form.description) }}
            <div id="chars-left-box">
              {{ "form_ad.characters_left"|trans({'%left%': desc_length - (data.description|length)})|raw }}
            </div>
          </div>

          <button id="long-desc-trigger" type="button" class="btn btn-info btn-block">{{"form_ad.content_trigger"|trans}}</button>
          <div id="create-ad-content" {% if not data.content %}class="hide"{% endif %}>
            {{ form_widget(form.content) }}
          </div>

          {{ form_widget(form.save, {
              attr: {
                'class': 'form-control btn btn-primary submit-disable-btn',
                'data-disable-text': "saving"|trans
              }
            })
          }}

          {{ form_rest(form) }}
        </div>
      {{ form_end(form) }}

      {{ elfinder_tinymce_init4() }}
      {{ tinymce_init() }}
    </div>
  </div>
  <div class="modal fade" id="examples-modal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">{{ "form_ad.example"|trans|title }}</h4>
        </div>
        <div class="modal-body">
          <ul>
            <li>{{ "form_ad.examples.example1"|trans }}</li>
            <li>{{ "form_ad.examples.example2"|trans }}</li>
            <li>{{ "form_ad.examples.example3"|trans }}</li>
            <li>{{ "form_ad.examples.example4"|trans }}</li>
            <li>{{ "form_ad.examples.example5"|trans }}</li>
          </ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">{{ "close"|trans }}</button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block javascripts %}
  {{ parent()  }}
  <script type="text/javascript">
    $(function() {
      var $trigger = $('#long-desc-trigger');
      var $content = $('#create-ad-content');
      var $charsLeft = $('#chars-left');
      var $desc = $('#{{ form.description.vars.id }}');
      $trigger.click(function() {
        $content.toggleClass('hide');  
      });
      var checkCharsLeft = function() {
        var val = $desc.val();
        if (val.length > {{ desc_length}} ) {
          if (val.length == {{ desc_length }} + 1) {
            return false;
          }

          $desc.val(val.substring(0, {{ desc_length }} - 1));
          return false;
        }
        $charsLeft.text({{ desc_length }} - val.length);
      }
      $desc.keyup(checkCharsLeft);
      //$desc.keypress(checkCharsLeft);
    });
  </script>
{% endblock %}
