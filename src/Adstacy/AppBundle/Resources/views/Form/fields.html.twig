{% extends 'form_div_layout.html.twig' %}

{% block form_label %}
{% spaceless %}
    {% if label is not sameas(false) %}
        {% if not compound %}
            {% set label_attr = label_attr|merge({'for': id}) %}
        {% endif %}
        {% if required %}
            {% set label_attr = label_attr|merge({'class': (label_attr.class|default('') ~ ' required')|trim}) %}
        {% endif %}
        {% if label is empty %}
            {% set label = name|humanize %}
        {% endif %}
        <label{% for attrname, attrvalue in label_attr %} {{ attrname }}="{{ attrvalue }}"{% endfor %}>{{ label|trans({}, translation_domain) }}{% if required %} <span class="required">*</span>{% endif %}</label>
    {% endif %}
{% endspaceless %}
{% endblock form_label %}

{% block form_errors %}
{% spaceless %}
    {% if errors|length > 0 %}
      {% for error in errors %}
      <div class="alert alert-warning alert-dismissable">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        <strong>Warning</strong>! {{ error.message }}
      </div>
      {% endfor %}
    {% endif %}
{% endspaceless %}
{% endblock %}

{% block image_widget %}
{% set imageExists = obj and obj.image and obj.imagename %}
<input class="image-upload hide" type="file" name="{{ full_name }}" {% if not imageExists and image_required %}required=required{% endif %}>

<div class="input-group">
  <input type="text" class="form-control image-upload-text image-upload-trigger" placeholder="Click to choose image" />
  <span class="input-group-btn">
    <button class="btn btn-default btn-info image-upload-trigger" type="button">Choose Image</button>
  </span>
</div>
<div class="image-preview {{ image_size }}">
  {% if imageExists %}
    <img src="{{ vich_uploader_asset(obj, 'image') }}">
  {% else %}
    <img>
  {% endif %}
</div>

<script type="text/javascript">
  $(function() {
    var $upload = $('.image-upload');
    var $preview = $('.image-preview');
    var $trigger = $('.image-upload-trigger');
    var $text = $('.image-upload-text');
    $upload.change(function(e) {
      var files = FileAPI.getFiles(e);
      if (files && files[0]) {
        FileAPI.readAsImage(files[0], function(evt) {
          if (evt.type == 'load') {
            $preview.find('img').replaceWith(evt.result);
            $text.val(files[0].name);
          }
        });
      }
    });
    $trigger.click(function() {
      $upload.trigger('click');
    });
  });
</script>
{% endblock %}
